import{r as n,M as I,b as _,c as v,f as e,t as x,x as f,y,U as L,h as N,i as B,o as F,a as C,F as T,n as W,g as M,u as j}from"./index-8ea70dc0.js";import{u as U}from"./useDate-48b5f23f.js";import{u as E,_ as S,a as q}from"./DeleteModal-2247c8af.js";const z={class:"modal-dialog modal-lg"},A={class:"modal-content border-0"},G={class:"modal-header bg-dark text-white"},H={class:"modal-title",id:"exampleModalLabel"},J=e("div",{"data-bs-theme":"dark"},[e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),K={class:"modal-body"},O={class:"row row-cols-2"},P={class:"mt-2 col"},Q=e("label",{class:"form-label",for:"title"},"名稱 ",-1),R={class:"mt-2 col"},X=e("label",{class:"form-label",for:"code"},"優惠碼 ",-1),Y={class:"mt-2"},Z=e("label",{class:"form-label",for:"percent"},"折扣百分比 ",-1),ee={class:"mt-2"},te=e("label",{class:"form-label",for:"due_date"},"到期日 ",-1),ae=e("hr",null,null,-1),oe={class:"mt-4"},le={class:"form-check"},se=e("label",{class:"form-check-label",for:"is_enabled"},[N("是否啟用 "),e("span",{class:"text-danger"},"(勾選更新狀態)")],-1),ne=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal","aria-label":"Close"}," 取消 ",-1),de={__name:"CouponModal",props:["coupon","title"],emits:["updataItem"],setup(D,{expose:u,emit:k}){const c=D,h=k,{toDate:w}=U(),o=n(null),a=n({title:"",code:"",due_date:"",is_enabled:0,percent:0}),r=n(""),{modalWindow:p,modalshow:b,modalhide:m}=E(),$=()=>{a.value={...a.value,due_date:o.value},h("updataItem",a.value)};return a.value=c.coupon,r.value=c.title,u({show:b,hide:m}),I(()=>c.coupon,(i,l)=>{(i.id!==l.id||i.is_enabled!==l.is_enabled)&&(a.value=i,r.value=c.title,a.value.due_date!==""?o.value=w(a.value.due_date):o.value="")}),(i,l)=>(_(),v("div",{class:"modal fade",id:"CouponModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"modalWindow",ref:p},[e("div",z,[e("div",A,[e("div",G,[e("h5",H,[e("span",null,x(r.value),1)]),J]),e("div",K,[e("form",null,[e("div",O,[e("div",P,[Q,f(e("input",{type:"text",class:"form-control",id:"title",placeholder:"優惠卷名稱","onUpdate:modelValue":l[0]||(l[0]=t=>a.value.title=t)},null,512),[[y,a.value.title]])]),e("div",R,[X,f(e("input",{type:"text",class:"form-control",id:"code",placeholder:"請輸入優惠碼","onUpdate:modelValue":l[1]||(l[1]=t=>a.value.code=t)},null,512),[[y,a.value.code]])]),e("div",Y,[Z,f(e("input",{type:"number",class:"form-control",id:"percent",placeholder:"請輸入折扣百分比","onUpdate:modelValue":l[2]||(l[2]=t=>a.value.percent=t)},null,512),[[y,a.value.percent,void 0,{number:!0}]])]),e("div",ee,[te,f(e("input",{type:"date",class:"form-control",id:"due_date",placeholder:"請選擇到期日","onUpdate:modelValue":l[3]||(l[3]=t=>o.value=t)},null,512),[[y,o.value]])])]),ae,e("div",oe,[e("div",le,[f(e("input",{id:"is_enabled","onUpdate:modelValue":l[4]||(l[4]=t=>a.value.is_enabled=t),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[L,a.value.is_enabled]]),se])])])]),e("div",{class:"modal-footer"},[ne,e("button",{type:"submit",class:"btn btn-primary",onClick:$},"確認")])])])],512))}},ie={class:"text-end"},ue={class:"table mt-4"},ce=e("thead",{class:"thead-dark"},[e("tr",null,[e("th",null,"名稱"),e("th",{width:"120"},"折扣百分比"),e("th",{width:"150"},"到期日"),e("th",{width:"150"},"是否啟用"),e("th",{width:"150"},"編輯")])],-1),re={key:0,class:"text-success"},pe={key:1},me=["onClick"],_e=["onClick"],fe={__name:"Coupons",setup(D){const u=B("emitter"),{toDate:k}=U(),c=n({}),h=n(""),w=n([]),o=n({}),a=n(null),r=n(!1),p=n(null),b=n(null);F(()=>{m()});const m=(t=1)=>{const d=`https://ec-course-api.hexschool.io/v2/api/207a7721/admin/coupons?page=${t}`;u.emit("isLoading",!0),C.get(d).then(s=>{w.value=s.data.coupons,c.value=s.data.pagination,u.emit("isLoading",!1)})},$=()=>{const t=`https://ec-course-api.hexschool.io/v2/api/207a7721/admin/coupon/${o.value.id}`;C.delete(t).then(()=>{u.emit("webmessage","此筆資料已經刪除","success"),m()}),b.value.hide()},i=(t,d)=>{switch(t){case"new":h.value="新增優惠卷",o.value={title:"",code:"",due_date:"",is_enabled:0,percent:0},r.value=!0,p.value.show();break;case"edit":h.value="編輯優惠卷",r.value=!1,o.value={...d},a.value=k(o.value.due_date),p.value.show();break;case"delete":o.value={...d},b.value.show();break}},l=t=>{let d="https://ec-course-api.hexschool.io/v2/api/207a7721/admin/coupon",s="post",g="新增優惠卷成功";r.value||(d=`https://ec-course-api.hexschool.io/v2/api/207a7721/admin/coupon/${t.id}`,s="put",g="更新優惠卷成功"),o.value={...o.value,due_date:Math.floor(new Date(t.due_date)/1e3)},C[s](d,{data:o.value}).then(()=>{p.value.hide(),u.emit("webmessage",g,"success"),m()}).catch(()=>{p.value.hide(),u.emit("webmessage","更新出錯","warning")})};return(t,d)=>(_(),v("div",null,[e("div",ie,[e("button",{class:"btn btn-primary",onClick:d[0]||(d[0]=s=>i("new")),"data-toggle":"modal","data-target":"#CouponsModal"},"建立新的優惠卷")]),e("table",ue,[ce,e("tbody",null,[(_(!0),v(T,null,W(w.value,(s,g)=>(_(),v("tr",{key:g},[e("td",null,x(s.title),1),e("td",null,x(s.percent)+" % ",1),e("td",null,x(j(k)(s.due_date)),1),e("td",null,[s.is_enabled===1?(_(),v("span",re,"啟用")):(_(),v("span",pe,"未啟用"))]),e("td",null,[e("button",{class:"btn btn-outline-primary btn-sm",onClick:V=>i("edit",s)},"編輯",8,me),e("button",{class:"btn btn-outline-primary btn-sm",onClick:V=>i("delete",s)},"刪除",8,_e)])]))),128))])]),M(S,{pages:c.value,onUpdatapage:m},null,8,["pages"]),M(de,{coupon:o.value,title:h.value,onUpdataItem:l,ref_key:"openCoupon",ref:p},null,8,["coupon","title"]),M(q,{item:o.value,onDelData:$,ref_key:"openDelete",ref:b},null,8,["item"])]))}};export{fe as default};
