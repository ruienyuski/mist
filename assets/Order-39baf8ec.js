import{r as p,M as I,b as n,c as i,f as e,t as d,x as g,y as $,F as V,n as U,d as N,U as B,h as E,i as q,o as F,a as M,g as C,u as T}from"./index-47672147.js";import{u as W,_ as j,a as S}from"./DeleteModal-91e10aaf.js";import{u as z}from"./useDate-48b5f23f.js";const A={class:"modal-dialog modal-lg"},G={class:"modal-content border-0"},H={class:"modal-header bg-dark text-white"},J={class:"modal-title",id:"exampleModalLabel"},K=e("div",{"data-bs-theme":"dark"},[e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),P={class:"modal-body"},Q={class:"row row-cols-2"},R={class:"mt-2 col"},X=e("label",{class:"form-label",for:"title"},"客戶名稱 ",-1),Y={class:"mt-2 col"},Z=e("label",{class:"form-label",for:"email"},"Email ",-1),ee={class:"mt-2"},te=e("label",{class:"form-label",for:"tel"},"電話 ",-1),se={class:"mt-2"},le=e("label",{class:"form-label",for:"address"},"地址 ",-1),ae=e("hr",null,null,-1),oe={class:"mt-2"},de={class:"list-group"},ne=e("li",{class:"list-group-item active","aria-current":"true"},"購買項目",-1),ie={class:"mt-2"},re={key:0,class:"list-group"},ce=e("li",{class:"list-group-item active","aria-current":"true"},"優惠卷",-1),ue={class:"list-group-item"},me={class:"list-group-item"},pe=e("hr",null,null,-1),_e={class:"mt-2"},he=e("label",{class:"form-label",for:"amount"},"應付金額",-1),ve=["value"],be={class:"mt-4"},fe={class:"form-check"},ge=e("label",{class:"form-check-label",for:"is_paid"},[E("是否付款 "),e("span",{class:"text-danger"},"(勾選更新狀態)")],-1),ye=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal","aria-label":"Close"}," 取消 ",-1),ke={__name:"OrderModal",props:["order","title"],emits:["updataItem"],setup(L,{expose:u,emit:w}){const _=L,y=w,t=p({user:{name:"",email:"",address:"",tel:""},coupon:{code:"",title:"",percent:"",enabled:"",deadline_at:""}}),c=p(""),{modalWindow:b,modalshow:f,modalhide:h}=W(),D=()=>{y("updataItem",t.value)};return t.value=_.order,c.value=_.title,u({show:f,hide:h}),I(()=>_.order,(v,s)=>{(v.id!==s.id||v.is_enabled!==s.is_enabled)&&(t.value=v,c.value=_.title)}),(v,s)=>{var k,a,r,l,x,m;return n(),i("div",{class:"modal fade",id:"orderModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"modalWindow",ref:b},[e("div",A,[e("div",G,[e("div",H,[e("h5",J,[e("span",null,d(c.value),1)]),K]),e("div",P,[e("form",null,[e("div",Q,[e("div",R,[X,g(e("input",{type:"text",class:"form-control",id:"title",placeholder:"客戶名稱","onUpdate:modelValue":s[0]||(s[0]=o=>t.value.user.name=o)},null,512),[[$,t.value.user.name]])]),e("div",Y,[Z,g(e("input",{type:"email",class:"form-control",id:"email",placeholder:"Email","onUpdate:modelValue":s[1]||(s[1]=o=>t.value.user.email=o)},null,512),[[$,t.value.user.email]])]),e("div",ee,[te,g(e("input",{type:"tel",class:"form-control",id:"tel",placeholder:"電話","onUpdate:modelValue":s[2]||(s[2]=o=>t.value.user.tel=o)},null,512),[[$,t.value.user.tel]])]),e("div",se,[le,g(e("input",{type:"email",class:"form-control",id:"address",placeholder:"地址","onUpdate:modelValue":s[3]||(s[3]=o=>t.value.user.address=o)},null,512),[[$,t.value.user.address]])])]),ae,e("div",oe,[e("ul",de,[ne,(n(!0),i(V,null,U(t.value.products,(o,O)=>(n(),i("li",{class:"list-group-item",key:O},d(o.product.title)+" x "+d(o.qty),1))),128))])]),e("div",ie,[(a=(k=t.value)==null?void 0:k.coupon)!=null&&a.title?(n(),i("ul",re,[ce,e("li",ue,"活動："+d((l=(r=t.value)==null?void 0:r.coupon)==null?void 0:l.title),1),e("li",me,"折扣："+d((m=(x=t.value)==null?void 0:x.coupon)==null?void 0:m.percent),1)])):N("",!0)]),pe,e("div",_e,[he,e("input",{type:"number",class:"form-control",id:"amount",placeholder:"應付金額",value:t.value.total,disabled:""},null,8,ve)]),e("div",be,[e("div",fe,[g(e("input",{id:"is_paid","onUpdate:modelValue":s[4]||(s[4]=o=>t.value.is_paid=o),class:"form-check-input",type:"checkbox"},null,512),[[B,t.value.is_paid]]),ge])])])]),e("div",{class:"modal-footer"},[ye,e("button",{type:"submit",class:"btn btn-primary",onClick:D},"確認")])])])],512)}}},xe={class:"table mt-5"},$e=e("thead",{class:"thead-dark"},[e("tr",null,[e("th",null,"#"),e("th",null,"訂單日期"),e("th",null,"客戶名稱"),e("th",null,"購買產品"),e("th",null,"應付金額"),e("th",null,"是否付款"),e("th",{scope:"col"},"編輯")])],-1),we={scope:"row"},De={class:"text-right"},Me={class:"custom-control custom-switch"},Ce={key:0,class:"text-success"},Ve={key:1,class:"text-danger"},Ue=["onClick"],Le=["onClick"],Be={__name:"Order",setup(L){const u=q("emitter"),{toDate:w}=z(),_=p([]),y=p({}),t=p(""),c=p({user:{name:"",email:"",address:"",tel:""},coupon:{code:"",title:"",percent:"",enabled:"",deadline_at:""}}),b=p(null),f=p(null);F(()=>{h()});const h=(a=1)=>{u.emit("isLoading",!0);const r=`https://ec-course-api.hexschool.io/v2/api/207a7721/admin/orders?page=${a}`;M.get(r).then(l=>{_.value=l.data.orders,y.value=l.data.pagination,u.emit("isLoading",!1)})},D=a=>{u.emit("isLoading",!0),c.value=a,u.emit("isLoading",!1),b.value.show()},v=()=>{const a=`https://ec-course-api.hexschool.io/v2/api/207a7721/admin/order/${c.value.id}`;M.delete(a).then(()=>{u.emit("webmessage","此筆資料已經刪除","success"),h()}),f.value.hide()},s=(a,r)=>{switch(a){case"edit":t.value="訂單資訊",D(r);break;case"delete":c.value={...r},f.value.show();break}},k=a=>{const r=`https://ec-course-api.hexschool.io/v2/api/207a7721/admin/order/${a.id}`;M.put(r,{data:a}).then(l=>{u.emit("webmessage",l.data.message,"success"),h(),b.value.hide()})};return(a,r)=>(n(),i("div",null,[e("table",xe,[$e,e("tbody",null,[(n(!0),i(V,null,U(_.value,(l,x)=>(n(),i("tr",{key:l.id},[e("th",we,d(x+1),1),e("td",null,d(T(w)(l.create_at)),1),e("td",null,d(l.user.name),1),e("td",null,[(n(!0),i(V,null,U(l.products,(m,o)=>(n(),i("p",{key:o},d(m.product.title)+" 【"+d(m.qty)+" "+d(m.product.unit)+"】 ",1))),128))]),e("td",De,d(l.total)+" ",1),e("td",null,[e("div",Me,[l.is_paid?(n(),i("strong",Ce,"已付款")):(n(),i("span",Ve,"尚未付款"))])]),e("td",null,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm mr-1","data-toggle":"modal",onClick:m=>s("edit",l)}," 編輯 ",8,Ue),e("button",{type:"button",class:"btn btn-outline-danger btn-sm","data-toggle":"modal",onClick:m=>s("delete",l)}," 刪除 ",8,Le)])]))),128))])]),C(j,{pages:y.value,onUpdatapage:h},null,8,["pages"]),C(ke,{order:c.value,title:t.value,onUpdataItem:k,ref_key:"openOrder",ref:b},null,8,["order","title"]),C(S,{item:c.value,onDelData:v,ref_key:"openDelete",ref:f},null,8,["item"])]))}};export{Be as default};
