import{i as R,r as d,M as z,m as G,b,c as g,f as e,t as F,x as u,y as f,h as U,d as H,U as T,F as W,n as O,V as J,a as w,o as K,g as B}from"./index-29270a80.js";import{r as Q,u as L,w as X}from"./xlsx-29548d43.js";import{u as Y,_ as Z,a as P}from"./DeleteModal-a6dded6f.js";const ee={class:"modal-dialog modal-lg"},te={class:"modal-content border-0"},se={class:"modal-header bg-dark text-white"},oe={class:"modal-title",id:"exampleModalLabel"},le=e("div",{"data-bs-theme":"dark"},[e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),ae={class:"modal-body"},ne={class:"row justify-content-center"},ie={class:"col-4"},ce={class:"mt-2"},de=e("label",{for:"img"},"輸入主圖網址",-1),re={class:"mt-2"},ue={class:"form-label",for:"customFile"},pe={key:0,class:"fas fa-spinner fa-spin"},me={class:"mt-4"},he=e("div",{class:"fs-6 text-danger my-2"},"主圖 (商品列表預覽圖片)",-1),_e=["src"],ve={class:"col-8"},fe={class:"mt-2"},be=e("label",{class:"form-label",for:"title"},[U("標題 "),e("span",{class:"text-danger"},"(必填)")],-1),ge={class:"row"},ye={class:"mt-2 col-md-6"},xe=e("label",{class:"form-label",for:"category"},[U("分類 "),e("span",{class:"text-danger"},"(必填)")],-1),ke={class:"mt-2 col-md-6"},we=e("label",{class:"form-label",for:"price"},[U("單位 "),e("span",{class:"text-danger"},"(必填)")],-1),$e={class:"row"},Ue={class:"mt-2 col-md-6"},Ve=e("label",{class:"form-label",for:"origin_price"},[U("原價 "),e("span",{class:"text-danger"},"(必填)")],-1),Ce={class:"mt-2 col-md-6"},De=e("label",{class:"form-label",for:"price"},[U("售價 "),e("span",{class:"text-danger"},"(必填)")],-1),Me=e("hr",null,null,-1),Fe={class:"mt-2"},je=e("label",{class:"form-label",for:"category"},"廣告分類 ",-1),Le={class:"mt-2"},Ie=e("label",{class:"form-label",for:"content"},"說明內容 ",-1),Ne={class:"mt-2"},Se=e("label",{class:"form-label",for:"content"},"產品描述 ",-1),Be={class:"mt-2"},Ee={class:"form-check"},Ae=e("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),Re={class:"col row justify-content-center"},Te=e("div",{class:"fs-6 text-danger my-2"},"已上傳的圖片，勾選設定主圖",-1),We={class:"row justify-content-center row-cols-3 g-3"},Oe={class:"form-check w-50"},qe=["value","id"],ze=["for"],Ge=["src"],He={class:"modal-footer"},Je=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal","aria-label":"Close"},"取消",-1),Ke=["disabled"],Qe={__name:"ProductModal",props:["product","title"],emits:["updataItem"],setup(E,{expose:c,emit:V}){const C=R("emitter"),r=E,D=V,t=d({}),h=d(""),y=d(!1),x=d(null),{modalWindow:k,modalshow:_,modalhide:I}=Y(),N=()=>{D("updataItem",t.value)};t.value=r.product,h.value=r.title,c({show:_,hide:I}),z(()=>r.product,(p,s)=>{(p.id!==s.id||p.is_enabled!==s.is_enabled)&&(t.value=p,h.value=r.title)});const M=G(()=>{var p,s,o,i,$;return!!((p=t==null?void 0:t.value)!=null&&p.title)&&!!((s=t==null?void 0:t.value)!=null&&s.category)&&!!((o=t==null?void 0:t.value)!=null&&o.unit)&&!!((i=t==null?void 0:t.value)!=null&&i.origin_price)&&!!(($=t==null?void 0:t.value)!=null&&$.price)}),S=()=>{t.value.imagesUrl||(t.value.imagesUrl=[]);const p=x.value.files[0],s=new FormData;s.append("file",p);const o="https://ec-course-api.hexschool.io/v2/api/207a7721/admin/upload";y.value=!0,w.post(o,s,{headers:{"Content-Type":"multipart/form-data"}}).then(i=>{y.value=!1,i.data.success&&(C.emit("webmessage","圖片上傳成功","success"),t.value.imagesUrl.push(i.data.imageUrl))}).catch(i=>{console.log(i),C.emit("webmessage","圖片上傳失敗，請確認上傳不可超過 2 MB","warning"),y.value=!1})};return(p,s)=>(b(),g("div",{class:"modal fade",id:"productModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"modalWindow",ref:k},[e("div",ee,[e("div",te,[e("div",se,[e("h5",oe,[e("span",null,F(h.value),1)]),le]),e("div",ae,[e("form",ne,[e("div",ie,[e("div",ce,[de,u(e("input",{id:"img","onUpdate:modelValue":s[0]||(s[0]=o=>t.value.imageUrl=o),type:"text",class:"form-control",placeholder:"請輸入圖片連結"},null,512),[[f,t.value.imageUrl]])]),e("div",re,[e("label",ue,[U(" 上傳圖片 "),y.value?(b(),g("i",pe)):H("",!0)]),e("input",{id:"customFile",ref_key:"file",ref:x,type:"file",class:"form-control",onChange:S},null,544)]),e("div",me,[he,e("img",{class:"img-fluid",src:t.value.imageUrl||"",style:{width:"200px",height:"200px","object-fit":"cover"},alt:""},null,8,_e)])]),e("div",ve,[e("div",fe,[be,u(e("input",{type:"text",class:"form-control",id:"title",placeholder:"請輸入標題","onUpdate:modelValue":s[1]||(s[1]=o=>t.value.title=o)},null,512),[[f,t.value.title]])]),e("div",ge,[e("div",ye,[xe,u(e("input",{type:"text",class:"form-control",id:"category",placeholder:"請輸入分類","onUpdate:modelValue":s[2]||(s[2]=o=>t.value.category=o)},null,512),[[f,t.value.category]])]),e("div",ke,[we,u(e("input",{type:"unit",class:"form-control",id:"unit",placeholder:"請輸入單位","onUpdate:modelValue":s[3]||(s[3]=o=>t.value.unit=o)},null,512),[[f,t.value.unit]])])]),e("div",$e,[e("div",Ue,[Ve,u(e("input",{type:"number",class:"form-control",id:"origin_price",placeholder:"請輸入原價","onUpdate:modelValue":s[4]||(s[4]=o=>t.value.origin_price=o)},null,512),[[f,t.value.origin_price]])]),e("div",Ce,[De,u(e("input",{type:"number",class:"form-control",id:"price",placeholder:"請輸入售價","onUpdate:modelValue":s[5]||(s[5]=o=>t.value.price=o)},null,512),[[f,t.value.price]])])]),Me,e("div",Fe,[je,u(e("input",{type:"text",class:"form-control",id:"category","onUpdate:modelValue":s[6]||(s[6]=o=>t.value.advertise=o)},null,512),[[f,t.value.advertise]])]),e("div",Le,[Ie,u(e("textarea",{type:"text",class:"form-control",id:"content",placeholder:"","onUpdate:modelValue":s[7]||(s[7]=o=>t.value.content=o)},null,512),[[f,t.value.content]])]),e("div",Ne,[Se,u(e("textarea",{type:"text",class:"form-control",id:"content",placeholder:"請輸入產品描述","onUpdate:modelValue":s[8]||(s[8]=o=>t.value.description=o)},null,512),[[f,t.value.description]])]),e("div",Be,[e("div",Ee,[u(e("input",{id:"is_enabled","onUpdate:modelValue":s[9]||(s[9]=o=>t.value.is_enabled=o),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[T,t.value.is_enabled]]),Ae])])]),e("div",Re,[Te,e("div",We,[(b(!0),g(W,null,O(t.value.imagesUrl,(o,i)=>(b(),g("div",{class:"row justify-content-center",key:i},[e("div",Oe,[u(e("input",{class:"form-check-input",type:"radio","onUpdate:modelValue":s[10]||(s[10]=$=>t.value.imageUrl=$),value:o,name:"flexRadioDefault",id:i},null,8,qe),[[J,t.value.imageUrl]]),e("label",{class:"form-check-label",for:i}," 設為主圖 ",8,ze)]),e("img",{class:"img-fluid",src:t.value.imagesUrl[i],style:{width:"200px",height:"200px","object-fit":"cover"},alt:""},null,8,Ge)]))),128))])])])]),e("div",He,[Je,e("button",{type:"submit",class:"btn btn-primary",onClick:N,disabled:!M.value},"確認",8,Ke)])])])],512))}},Xe={class:"row justify-content-between"},Ye={class:"col-9"},Ze={class:"row"},Pe={class:"col-4"},et={class:"col-3"},tt={class:"table"},st=e("thead",{class:"thead-dark"},[e("tr",null,[e("th",{scope:"col"},"#"),e("th",{scope:"col"},"分類"),e("th",{scope:"col"},"產品名稱"),e("th",{scope:"col"},"價格"),e("th",{scope:"col"},"是否上架"),e("th",{scope:"col"},"編輯")])],-1),ot={scope:"row"},lt={class:"form-check form-switch"},at=["id","onUpdate:modelValue","onChange"],nt=["for"],it={key:0,class:"text-success"},ct={key:1,class:"text-muted"},dt=["onClick"],rt=["onClick"],_t={__name:"Products",setup(E){const c=R("emitter"),V=d([]),C=d({}),r=d({}),D=d(""),t=d(!1),h=d(null),y=d(null),x=d([]),k=d(null);K(()=>{_()});const _=(a=1)=>{c.emit("isLoading",!0);const n=`https://ec-course-api.hexschool.io/v2/api/207a7721/admin/products?page=${a}`;w.get(n).then(l=>{V.value=l.data.products,C.value=l.data.pagination,c.emit("isLoading",!1)})},I=a=>{c.emit("isLoading",!0),r.value=a,c.emit("isLoading",!1),h.value.show()},N=a=>{const n=`https://ec-course-api.hexschool.io/v2/api/207a7721/admin/product/${a.id}`;w.delete(n).then(()=>{c.emit("webmessage","此筆資料已經刪除","success"),_()}),y.value.hide()},M=(a,n)=>{switch(a){case"new":D.value="新增產品",r.value={imageUrl:"",imagesUrl:[]},t.value=!0,h.value.show();break;case"edit":D.value="編輯產品",t.value=!1,I(n);break;case"delete":r.value={...n},y.value.show();break}},S=a=>{let n="https://ec-course-api.hexschool.io/v2/api/207a7721/admin/product",l="post";c.emit("isLoading",!0);let v="新增產品成功";t.value||(l="put",n=`https://ec-course-api.hexschool.io/v2/api/207a7721/admin/product/${a.id}`,v="更新產品成功"),w[l](n,{data:a}).then(()=>{c.emit("webmessage",v,"success"),_(),h.value.hide()}).catch(m=>{c.emit("isLoading",!1),h.value.hide(),c.emit("webmessage",`錯誤訊息: ${m.response.data.message}`,"danger")})},p=a=>{const n=`https://ec-course-api.hexschool.io/v2/api/207a7721/admin/product/${a.id}`;r.value={...a},w.put(n,{data:r.value}).then(()=>{_()})},s=a=>{k.value=a.target.files[0],k.value&&o()},o=()=>{const a=new FileReader;a.onload=n=>{const l=new Uint8Array(n.target.result),v=Q(l,{type:"array"}),m=v.Sheets[v.SheetNames[0]];L.sheet_to_json(m).forEach(j=>{V.value.find(q=>q.title===j.title)?c.emit("webmessage","錯誤訊息: 上傳的 excel 內有重複資料","danger"):(j.id="",j.is_enabled=0,x.value.push(j))}),_()},a.readAsArrayBuffer(k.value)},i=()=>{if(x.value.length>0){const a="https://ec-course-api.hexschool.io/v2/api/207a7721/admin/product";for(const n of x.value){const l={data:n};w.post(a,l).then(()=>{_()})}}else c.emit("webmessage","錯誤訊息: 請重新上傳 excel","danger");x.value="",k.value.value=null},$=()=>{const a="https://ec-course-api.hexschool.io/v2/api/207a7721/admin/products/all";w.get(a).then(n=>{const l=Object.keys(n.data.products).map(A=>n.data.products[A]),v=L.json_to_sheet(l),m=L.book_new();L.book_append_sheet(m,v,"Sheet1"),X(m,"products.xlsx")})};return(a,n)=>(b(),g("div",null,[e("div",Xe,[e("div",Ye,[e("div",Ze,[e("div",Pe,[e("input",{type:"file",class:"my-3 form-control",ref_key:"fileInput",ref:k,onChange:s},null,544)]),e("div",{class:"col"},[e("button",{type:"button",class:"my-3 btn btn-light",onClick:i},"上傳Excel文件(*.xlsx) "),e("button",{type:"button",class:"my-3 btn btn-light",onClick:$},"下載Excel文件 ")])])]),e("div",et,[e("button",{type:"button",class:"my-3 btn btn-primary",onClick:n[0]||(n[0]=l=>M("new",!0))}," 新建產品 ")])]),e("table",tt,[st,e("tbody",null,[(b(!0),g(W,null,O(V.value,(l,v)=>(b(),g("tr",{key:l.id},[e("th",ot,F(v+1),1),e("td",null,F(l.category),1),e("td",null,F(l.title),1),e("td",null,F(l.price),1),e("td",null,[e("div",lt,[u(e("input",{id:l.id,"onUpdate:modelValue":m=>l.is_enabled=m,"true-value":1,"false-value":0,type:"checkbox",class:"form-check-input",onChange:m=>p(l)},null,40,at),[[T,l.is_enabled]]),e("label",{class:"form-check-label",for:l.id},[l.is_enabled===1?(b(),g("strong",it,"已上架")):(b(),g("span",ct,"尚未上架"))],8,nt)])]),e("td",null,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm mr-1",onClick:m=>M("edit",l)}," 編輯 ",8,dt),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:m=>M("delete",l)}," 刪除 ",8,rt)])]))),128))])]),B(Z,{pages:C.value,onUpdatapage:_},null,8,["pages"]),B(Qe,{product:r.value,title:D.value,onUpdataItem:S,ref_key:"openProduct",ref:h},null,8,["product","title"]),B(P,{item:r.value,onDelData:N,ref_key:"openDelete",ref:y},null,8,["item"])]))}};export{_t as default};
