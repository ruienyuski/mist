import{r as m,M as E,b as i,c as r,f as e,t as d,x as y,y as w,F as L,n as O,d as N,U as q,h as B,i as F,o as S,a as M,g as V,u as T}from"./index-8ea70dc0.js";import{u as U,w as W}from"./xlsx-29548d43.js";import{u as z,_ as A,a as G}from"./DeleteModal-2247c8af.js";import{u as H}from"./useDate-48b5f23f.js";const J={class:"modal-dialog modal-lg"},K={class:"modal-content border-0"},P={class:"modal-header bg-dark text-white"},Q={class:"modal-title",id:"exampleModalLabel"},R=e("div",{"data-bs-theme":"dark"},[e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),X={class:"modal-body"},Y={class:"row row-cols-2"},Z={class:"mt-2 col"},ee=e("label",{class:"form-label",for:"title"},"客戶名稱 ",-1),te={class:"mt-2 col"},se=e("label",{class:"form-label",for:"email"},"Email ",-1),oe={class:"mt-2"},le=e("label",{class:"form-label",for:"tel"},"電話 ",-1),ae={class:"mt-2"},ne=e("label",{class:"form-label",for:"address"},"地址 ",-1),de=e("hr",null,null,-1),ie={class:"mt-2"},re={class:"list-group"},ce=e("li",{class:"list-group-item active","aria-current":"true"},"購買項目",-1),ue={class:"mt-2"},pe={key:0,class:"list-group"},me=e("li",{class:"list-group-item active","aria-current":"true"},"優惠卷",-1),_e={class:"list-group-item"},he={class:"list-group-item"},ve=e("hr",null,null,-1),be={class:"mt-2"},fe=e("label",{class:"form-label",for:"amount"},"應付金額",-1),ge=["value"],ye={class:"mt-4"},ke={class:"form-check"},xe=e("label",{class:"form-check-label",for:"is_paid"},[B("是否付款 "),e("span",{class:"text-danger"},"(勾選更新狀態)")],-1),$e=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal","aria-label":"Close"}," 取消 ",-1),we={__name:"OrderModal",props:["order","title"],emits:["updataItem"],setup(I,{expose:p,emit:D}){const c=I,k=D,s=m({user:{name:"",email:"",address:"",tel:""},coupon:{code:"",title:"",percent:"",enabled:"",deadline_at:""}}),u=m(""),{modalWindow:f,modalshow:g,modalhide:v}=z(),C=()=>{k("updataItem",s.value)};return s.value=c.order,u.value=c.title,p({show:g,hide:v}),E(()=>c.order,(b,o)=>{(b.id!==o.id||b.is_enabled!==o.is_enabled)&&(s.value=b,u.value=c.title)}),(b,o)=>{var x,$,l,n,a,_;return i(),r("div",{class:"modal fade",id:"orderModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref_key:"modalWindow",ref:f},[e("div",J,[e("div",K,[e("div",P,[e("h5",Q,[e("span",null,d(u.value),1)]),R]),e("div",X,[e("form",null,[e("div",Y,[e("div",Z,[ee,y(e("input",{type:"text",class:"form-control",id:"title",placeholder:"客戶名稱","onUpdate:modelValue":o[0]||(o[0]=t=>s.value.user.name=t)},null,512),[[w,s.value.user.name]])]),e("div",te,[se,y(e("input",{type:"email",class:"form-control",id:"email",placeholder:"Email","onUpdate:modelValue":o[1]||(o[1]=t=>s.value.user.email=t)},null,512),[[w,s.value.user.email]])]),e("div",oe,[le,y(e("input",{type:"tel",class:"form-control",id:"tel",placeholder:"電話","onUpdate:modelValue":o[2]||(o[2]=t=>s.value.user.tel=t)},null,512),[[w,s.value.user.tel]])]),e("div",ae,[ne,y(e("input",{type:"email",class:"form-control",id:"address",placeholder:"地址","onUpdate:modelValue":o[3]||(o[3]=t=>s.value.user.address=t)},null,512),[[w,s.value.user.address]])])]),de,e("div",ie,[e("ul",re,[ce,(i(!0),r(L,null,O(s.value.products,(t,h)=>(i(),r("li",{class:"list-group-item",key:h},d(t.product.title)+" x "+d(t.qty),1))),128))])]),e("div",ue,[($=(x=s.value)==null?void 0:x.coupon)!=null&&$.title?(i(),r("ul",pe,[me,e("li",_e,"活動："+d((n=(l=s.value)==null?void 0:l.coupon)==null?void 0:n.title),1),e("li",he,"折扣："+d((_=(a=s.value)==null?void 0:a.coupon)==null?void 0:_.percent),1)])):N("",!0)]),ve,e("div",be,[fe,e("input",{type:"number",class:"form-control",id:"amount",placeholder:"應付金額",value:s.value.total,disabled:""},null,8,ge)]),e("div",ye,[e("div",ke,[y(e("input",{id:"is_paid","onUpdate:modelValue":o[4]||(o[4]=t=>s.value.is_paid=t),class:"form-check-input",type:"checkbox"},null,512),[[q,s.value.is_paid]]),xe])])])]),e("div",{class:"modal-footer"},[$e,e("button",{type:"submit",class:"btn btn-primary",onClick:C},"確認")])])])],512)}}},De={class:"table mt-5"},Ce=e("thead",{class:"thead-dark"},[e("tr",null,[e("th",null,"#"),e("th",null,"訂單日期"),e("th",null,"客戶名稱"),e("th",null,"購買產品"),e("th",null,"應付金額"),e("th",null,"是否付款"),e("th",{scope:"col"},"編輯")])],-1),Me={scope:"row"},Ve={class:"text-right"},Ue={class:"custom-control custom-switch"},Le={key:0,class:"text-success"},Oe={key:1,class:"text-danger"},Ie=["onClick"],je=["onClick"],Fe={__name:"Order",setup(I){const p=F("emitter"),{toDate:D}=H(),c=m([]),k=m({}),s=m(""),u=m({user:{name:"",email:"",address:"",tel:""},coupon:{code:"",title:"",percent:"",enabled:"",deadline_at:""}}),f=m(null),g=m(null);S(()=>{v()});const v=()=>{p.emit("isLoading",!0);const l="https://ec-course-api.hexschool.io/v2/api/207a7721/admin/orders";M.get(l).then(n=>{c.value=n.data.orders,k.value=n.data.pagination,p.emit("isLoading",!1);for(const a in c.value){const _=[],t=c.value[a];for(const h in t.products){let j=`${t.products[h].product.title} 【${t.products[h].qty} ${t.products[h].product.unit}】`;_.push(j)}t.productlist=_.join(", ")}})},C=l=>{p.emit("isLoading",!0),u.value=l,p.emit("isLoading",!1),f.value.show()},b=()=>{const l=`https://ec-course-api.hexschool.io/v2/api/207a7721/admin/order/${u.value.id}`;M.delete(l).then(()=>{p.emit("webmessage","此筆資料已經刪除","success"),v()}),g.value.hide()},o=(l,n)=>{switch(l){case"edit":s.value="訂單資訊",C(n);break;case"delete":u.value={...n},g.value.show();break}},x=l=>{const n=`https://ec-course-api.hexschool.io/v2/api/207a7721/admin/order/${l.id}`;M.put(n,{data:l}).then(a=>{p.emit("webmessage",a.data.message,"success"),v(),f.value.hide()})},$=()=>{const l=U.json_to_sheet(c.value),n=U.book_new();U.book_append_sheet(n,l,"Sheet1"),W(n,"orders.xlsx")};return(l,n)=>(i(),r("div",null,[e("div",{class:"text-end"},[e("button",{type:"button",class:"my-3 btn btn-light",onClick:$}," 下載Excel文件 ")]),e("table",De,[Ce,e("tbody",null,[(i(!0),r(L,null,O(c.value,(a,_)=>(i(),r("tr",{key:a.id},[e("th",Me,d(_+1),1),e("td",null,d(T(D)(a.create_at)),1),e("td",null,d(a.user.name),1),e("td",null,[(i(!0),r(L,null,O(a.products,(t,h)=>(i(),r("p",{key:h},d(t.product.title)+" 【"+d(t.qty)+" "+d(t.product.unit)+"】 ",1))),128))]),e("td",Ve,d(a.total)+" ",1),e("td",null,[e("div",Ue,[a.is_paid?(i(),r("strong",Le,"已付款")):(i(),r("span",Oe,"尚未付款"))])]),e("td",null,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm mr-1","data-toggle":"modal",onClick:t=>o("edit",a)}," 編輯 ",8,Ie),e("button",{type:"button",class:"btn btn-outline-danger btn-sm","data-toggle":"modal",onClick:t=>o("delete",a)}," 刪除 ",8,je)])]))),128))])]),V(A,{pages:k.value,onUpdatapage:v},null,8,["pages"]),V(we,{order:u.value,title:s.value,onUpdataItem:x,ref_key:"openOrder",ref:f},null,8,["order","title"]),V(G,{item:u.value,onDelData:b,ref_key:"openDelete",ref:g},null,8,["item"])]))}};export{Fe as default};
